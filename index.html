<!DOCTYPE html>
<html>
<head>
    <title>webgl demo</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script type="text/javascript" src="./js/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        .people {
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 1;
            width: 200px;
            height: 300px;
            position: fixed;
            bottom: 20px;
            transform: translate(-50%);
            z-index: 999;
        }

        .p1 {
            background-image: url("img/girl.gif");
            left: 50%;
        }

    </style>
</head>
<body>
<!--<div class="people p1"></div>-->
<script type="text/javascript">

    var speed = 7;
    var direction = 1;
    var currentIndex = 0;
    var isPause = false;
    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100000);
    var webGLRenderer = new THREE.WebGLRenderer({alpha: true});
    webGLRenderer.setClearColor(0x000000, 0.5);
    webGLRenderer.setSize(window.innerWidth, window.innerHeight);
    webGLRenderer.shadowMapEnabled = true;


   /* /!*旋转的立方体*!/
    //网格面材质
    var mats = [];

    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/27T.png')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/car.png')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/dayumi.png')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/futa.png')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/sexy-girl.gif')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/shizu.png')}));
    mats.push(new THREE.MeshBasicMaterial({map: THREE.ImageUtils.loadTexture('img/nei-1.png')}));


    var faceMaterial = new THREE.MeshFaceMaterial(mats);

    //创建一个立方体
    var cubeGeometry = new THREE.BoxGeometry(200, 200, 200);
    //将线框（wireframe）属性设置为true，这样物体就不会被渲染为实物物体
    // 感光材质
    var cubeMaterial = new THREE.MeshLambertMaterial({color: 0x006644, opacity: 1});

    var cube = new THREE.Mesh(cubeGeometry, faceMaterial);

    //设置立方体的位置
    cube.position.x = 400;
    cube.position.y = 200;
    cube.position.z = 800;
    /!*旋转的立方体*!/*/


    var imgList = [
        './img/1.jpg',
        './img/car.png',
        './img/nei-2.png',
        './img/nei-3.png',
        './img/nei-1.png',
    ];

    var imgLists = [
        [
            './img/1.jpg',
            './img/car.png',
            './img/nei-2.png',
            './img/nei-3.png',
            './img/nei-1.png',
        ],
        [
            './img/bg1.jpg',
            './img/27T.png',
            './img/shizu.png',
            './img/futa.png',
            './img/dayumi.png'
        ],
        [
            './img/bg1.jpg',
            './img/27T.png',
            './img/shizu.png',
            './img/futa.png',
            './img/dayumi.png'
        ],
        [
            './img/bg1.jpg',
            './img/nei-3.png'
        ]

    ];


    var data = [
        {name: 'bg', w: 2400, h: 2574, x: 0, y: 0, z: 0},
        {name: 'car', w: 595, h: 290, x: 0, y: 0, z: 100},
        {name: 'peo1', w: 204 * 0.8, h: 669 * 0.8, x: -280, y: -100, z: 550},
        {name: 'peo2', w: 217 * 0.7, h: 1002 * 0.7, x: 300, y: -180, z: 800},
        {name: 'peo3', w: 348 * 0.6, h: 1219 * 0.6, x: -100, y: -200, z: 1300}
    ];

    var dataLists = [
        [
            {name: 'bg', w: 2400, h: 2574, x: 0, y: 0, z: 0},
            {name: 'car', w: 595, h: 290, x: 0, y: 0, z: 100},
            {name: 'peo1', w: 204 * 0.8, h: 669 * 0.8, x: -280, y: -100, z: 550},
            {name: 'peo2', w: 217 * 0.7, h: 1002 * 0.7, x: 300, y: -180, z: 800},
            {name: 'peo3', w: 348 * 0.6, h: 1219 * 0.6, x: -100, y: -200, z: 1300}
        ],
        [
            {name: 'bg', w: 2400, h: 2574, x: 0, y: 0, z: 0},
            {name: '27T', w: 150 * 0.6, h: 800 * 0.6, x: -280, y: -200, z: 200},
            {name: 'shizu', w: 348 * 0.6, h: 619 * 0.6, x: 280, y: -200, z: 200},
            {name: 'futa', w: 150 * 0.6, h: 800 * 0.6, x: -280, y: -200, z: 800},
            {name: 'dayumi', w: 150 * 0.6, h: 619 * 0.6, x: 280, y: -200, z: 800}
        ],
        [
            {name: 'bg', w: 2400, h: 2574, x: 0, y: 0, z: 0},
            {name: 'peo1', w: 100 * 0.6, h: 800 * 0.6, x: -280, y: -200, z: 200},
            {name: 'peo2', w: 348 * 0.6, h: 619 * 0.6, x: 280, y: -200, z: 400}
        ],
        [
            {name: 'bg', w: 2400, h: 2574, x: 0, y: 0, z: 0},
            {name: 'peo3', w: 348 * 0.6, h: 1219 * 0.6, x: 150, y: -200, z: 1300}
        ]

    ];


    function drawScene(img, w, h, x, y, z) {
        var mapTexture = new THREE.TextureLoader().load(img);
        var sceneGeometry = new THREE.PlaneGeometry(w, h);
        var planeMaterial = new THREE.MeshBasicMaterial({
            transparent: true,
            map: mapTexture
        });
        var plane = new THREE.Mesh(sceneGeometry, planeMaterial);
        plane.position.x = x;
        plane.position.y = y;
        plane.position.z = z;
        // // 添加雾化效果
        // scene.fog = new THREE.Fog(0xffffff, 400, 5000);

        scene.add(plane);
    }

    // for(var i = 0; i < data.length; i++) {
    //     drawScene(imgList[i],data[i].w, data[i].h, data[i].x,data[i].y, data[i].z);
    // }
    // camera.position.x = 0;
    // camera.position.y = 0;
    // camera.position.z = 3000;
    // camera.lookAt(scene.position);

    function reDraw(imgList, dataList) {
        for (var i = 0; i < dataList.length; i++) {
            drawScene(imgList[i], dataList[i].w, dataList[i].h, dataList[i].x, dataList[i].y, dataList[i].z);
        }

        camera.position.x = 0;
        camera.position.y = 0;
        camera.position.z = 3000;
        camera.lookAt(scene.position);

        //将立方体添加到场景中
        // scene.add(cube);
    }

    reDraw(imgLists[currentIndex], dataLists[currentIndex]);


    function animate() {
        requestAnimationFrame(animate);

        // 立方体旋转动画
        // cube.rotation.x += .01;
        // cube.rotation.y += .02;


        render();
    }

    function render() {


        if (isPause) {
            scene.children.length = 0;
            if (currentIndex === 4) {
                currentIndex = 1
            }
            reDraw(imgLists[currentIndex], dataLists[currentIndex]);
            webGLRenderer.clear();
            webGLRenderer.render(scene, camera);
            isPause = false;
            return;
        }

        camera.position.z -= speed * direction;
        if (camera.position.z > 3000) {
            camera.position.z = 3000;
            isPause = true;
        }

        if (camera.position.z < 499) {
            camera.position.z = 500;
            isPause = true;
            currentIndex++;
        }
        webGLRenderer.clear();
        webGLRenderer.render(scene, camera);
    }

    document.body.appendChild(webGLRenderer.domElement);
    animate();


</script>
</body>
</html>